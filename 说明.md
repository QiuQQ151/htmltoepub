# 功能  
- 将html2txt和txt2epub功能合并
- 提供网页新闻抓取并制作epub工具
- 提供通用的抓取工具函数

# 已支持的网页
- 新华日报
- 南方日报

# 文件结构
- history/ 存放历史epub和txt
- temp/ 存放抓取到的数据以及epub打包目录
- lib/ 工具函数/库函数/抓取函数
- html2epub.sh 脚本执行
- main.c 主函数
- html2epub.exe 可执行文件

# 个人编辑部分
- lib/下的xxxx.c/h文件

# 生成的txt文件格式要求

```c
- （可选说明）
每日新闻        
日期：202410/25   
制作：QQQ

- （正文）
<图片:n>  -----------（无图）
1<标题:xxxx> --------（文章标号---标题）
 xxxx-----------------(正文，含换行符) 
<end>----------------（结束符）

<图片:2.jpg> ---------（有图）
2<标题:xxx>
xxxxxxx
<end>
``````

# 使用入口
```c
./html2epub.sh
```

# 安装工具
```bash
sudo apt install -y \
  gcc \
  make \
  build-essential \
  libcurl4-openssl-dev \
  libfreetype6-dev \
  libjpeg-dev
```

# 编译可执行文件
```c
 gcc -g main.c ./lib/epub.c ./lib/extract.c ./lib/xhrb.c ./lib/nfrb.c ./lib/mkjpg.c -o html2epub.exe -lcurl -I/usr/include/freetype2 -lfreetype -ljpeg
 ```

# bug记录
## 生成的epub封面缺少日期
- 原因：在封面中合成日期等字符，使用了系统的字体库，注意查看'lib/mkjpg.c'中定义的字体库路径，若无则安装字体或修改路径。

## 内存泄漏问题（已修复 - 2026/1/28）
### 问题描述
`lib/epub.c` 文件中存在多处内存泄漏，主要问题包括：
1. `content_opf_create`、`toc_ncx_create`、`chapter_create`、`index_create` 函数中分配的路径内存未释放
2. `toc_ncx_create` 和 `buil_article_list` 函数中 `num2char` 返回的动态内存未释放
3. `chapter_create` 函数中循环分配的临时内存未释放
4. `buil_article_list` 函数中 `sizeof(article_num)` 使用错误

### 修复内容
1. **content_opf_create 函数**：
   - 添加 `location` 内存释放
   - 在错误情况下添加 `free(location)`

2. **toc_ncx_create 函数**：
   - 添加 `location` 内存释放
   - 添加 `num_Order` 内存释放（`num2char` 返回）
   - 在错误情况下添加 `free(location)`

3. **chapter_create 函数**：
   - 添加 `location` 和 `chapterx` 内存释放（每次循环）
   - 在错误情况下添加 `free(location)` 和 `free(chapterx)`

4. **index_create 函数**：
   - 添加 `location` 内存释放
   - 在错误情况下添加 `free(location)`

5. **buil_article_list 函数**：
   - 修复 `sizeof(article_num)` 为 `strlen(article_num) + 1`
   - 添加 `article_num` 内存释放（`num2char` 返回）
   - 在错误情况下添加 `free(article_num)`

### 验证结果
- 编译测试通过，无语法错误
- 测试程序运行正常，成功生成 EPUB 相关文件
- 链表创建和释放过程正常
- 所有文件操作成功完成

修复后的代码更加健壮，避免了内存泄漏问题，提高了程序的稳定性和可靠性。
